<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Android FridaFridaå®åœ¨å¤ªå¸¸ç”¨äº†ï¼Œæ‰€ä»¥ç»“åˆç½‘ä¸Šçš„èµ„æ–™ä»¥åŠè‡ªå·±å¹³æ—¶çš„ä½¿ç”¨æ€»ç»“ä¸€ä»½Fridaæ–‡æ¡£ï¼Œä¹Ÿæ–¹ä¾¿è‡ªå·±æŸ¥ï¼Œä¸»è¦å‚è€ƒSakuraçš„è¿™ç¯‡æ–‡ç« ï¼Œåé¢æœ‰æ–°çš„å†æ€»ç»“ Frida Android hook | Sakuraã®blog (eternalsakura13.com) fridaç¯å¢ƒç›´æ¥ä¸‹è½½r0Pan /r0env R0envï¼Œé‡Œé¢æœ‰é…ç½®å¥½çš„pyenvä»¥åŠé¢„è£…çš„frida pyenv">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Frida">
<meta property="og:url" content="http://yoursite.com/2022/09/06/Android Frida/index.html">
<meta property="og:site_name" content="zzrR0">
<meta property="og:description" content="Android FridaFridaå®åœ¨å¤ªå¸¸ç”¨äº†ï¼Œæ‰€ä»¥ç»“åˆç½‘ä¸Šçš„èµ„æ–™ä»¥åŠè‡ªå·±å¹³æ—¶çš„ä½¿ç”¨æ€»ç»“ä¸€ä»½Fridaæ–‡æ¡£ï¼Œä¹Ÿæ–¹ä¾¿è‡ªå·±æŸ¥ï¼Œä¸»è¦å‚è€ƒSakuraçš„è¿™ç¯‡æ–‡ç« ï¼Œåé¢æœ‰æ–°çš„å†æ€»ç»“ Frida Android hook | Sakuraã®blog (eternalsakura13.com) fridaç¯å¢ƒç›´æ¥ä¸‹è½½r0Pan /r0env R0envï¼Œé‡Œé¢æœ‰é…ç½®å¥½çš„pyenvä»¥åŠé¢„è£…çš„frida pyenv">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2022/09/06/Android%20Frida/image-20220531161329831.png">
<meta property="og:image" content="http://yoursite.com/2022/09/06/Android%20Frida/image-20220531161924152.png">
<meta property="og:image" content="http://yoursite.com/2022/09/06/Android%20Frida/image-20220531175401090.png">
<meta property="og:image" content="http://yoursite.com/2022/09/06/Android%20Frida/image-20220718223514178.png">
<meta property="og:image" content="http://yoursite.com/2022/09/06/Android%20Frida/image-20220531171626939.png">
<meta property="og:updated_time" content="2022-09-19T00:46:05.535Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Frida">
<meta name="twitter:description" content="Android FridaFridaå®åœ¨å¤ªå¸¸ç”¨äº†ï¼Œæ‰€ä»¥ç»“åˆç½‘ä¸Šçš„èµ„æ–™ä»¥åŠè‡ªå·±å¹³æ—¶çš„ä½¿ç”¨æ€»ç»“ä¸€ä»½Fridaæ–‡æ¡£ï¼Œä¹Ÿæ–¹ä¾¿è‡ªå·±æŸ¥ï¼Œä¸»è¦å‚è€ƒSakuraçš„è¿™ç¯‡æ–‡ç« ï¼Œåé¢æœ‰æ–°çš„å†æ€»ç»“ Frida Android hook | Sakuraã®blog (eternalsakura13.com) fridaç¯å¢ƒç›´æ¥ä¸‹è½½r0Pan /r0env R0envï¼Œé‡Œé¢æœ‰é…ç½®å¥½çš„pyenvä»¥åŠé¢„è£…çš„frida pyenv">
<meta name="twitter:image" content="http://yoursite.com/2022/09/06/Android%20Frida/image-20220531161329831.png">






  <link rel="canonical" href="http://yoursite.com/2022/09/06/Android Frida/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Android Frida | zzrR0</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zzrR0</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/09/06/Android Frida/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zzrR0">
      <meta itemprop="description" content="Why am i so cai.">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zzrR0">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android Frida
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-06 12:01:52" itemprop="dateCreated datePublished" datetime="2022-09-06T12:01:52+08:00">2022-09-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-19 08:46:05" itemprop="dateModified" datetime="2022-09-19T08:46:05+08:00">2022-09-19</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2022/09/06/Android Frida/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/09/06/Android Frida/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2022/09/06/Android Frida/" class="leancloud_visitors" data-flag-title="Android Frida">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             é˜…è¯»æ¬¡æ•°ï¼š 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Android-Frida"><a href="#Android-Frida" class="headerlink" title="Android Frida"></a>Android Frida</h1><p>Fridaå®åœ¨å¤ªå¸¸ç”¨äº†ï¼Œæ‰€ä»¥ç»“åˆç½‘ä¸Šçš„èµ„æ–™ä»¥åŠè‡ªå·±å¹³æ—¶çš„ä½¿ç”¨æ€»ç»“ä¸€ä»½Fridaæ–‡æ¡£ï¼Œä¹Ÿæ–¹ä¾¿è‡ªå·±æŸ¥ï¼Œä¸»è¦å‚è€ƒSakuraçš„è¿™ç¯‡æ–‡ç« ï¼Œåé¢æœ‰æ–°çš„å†æ€»ç»“</p>
<p><a href="https://eternalsakura13.com/2020/07/04/frida/" target="_blank" rel="noopener">Frida Android hook | Sakuraã®blog (eternalsakura13.com)</a></p>
<h2 id="fridaç¯å¢ƒ"><a href="#fridaç¯å¢ƒ" class="headerlink" title="fridaç¯å¢ƒ"></a>fridaç¯å¢ƒ</h2><p>ç›´æ¥ä¸‹è½½<a href="http://49.235.84.125:8080/r0env" target="_blank" rel="noopener">r0Pan /r0env</a></p>
<p>R0envï¼Œé‡Œé¢æœ‰é…ç½®å¥½çš„pyenvä»¥åŠé¢„è£…çš„frida</p>
<h3 id="pyenv"><a href="#pyenv" class="headerlink" title="pyenv"></a>pyenv</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½ä¸€ä¸ª3.8.2ï¼Œä¸‹è½½çœŸçš„å¾ˆæ…¢ï¼Œè¦æ…¢æ…¢ç­‰</span><br><span class="line">pyenv install 3.8.2</span><br><span class="line"></span><br><span class="line">pyenv versions</span><br><span class="line">sakura@sakuradeMacBook-Pro:~$ pyenv versions</span><br><span class="line">  system</span><br><span class="line">* 3.8.2 (set by /Users/sakura/.python-version)</span><br><span class="line">åˆ‡æ¢åˆ°æˆ‘ä»¬è£…çš„</span><br><span class="line">pyenv local 3.8.2</span><br><span class="line">python -V</span><br><span class="line">pip -V</span><br><span class="line">åŸæœ¬ç³»ç»Ÿè‡ªå¸¦çš„</span><br><span class="line">python local system</span><br><span class="line">python -V</span><br><span class="line"></span><br><span class="line">æŠŠæ•´ä¸ªç³»ç»Ÿçš„pythonåˆ‡æ¢</span><br><span class="line">python global XXXX</span><br></pre></td></tr></table></figure>
<p>ä¸´æ—¶ç¦ç”¨pyenv</p>
<p><img src="/2022/09/06/Android Frida/image-20220531161329831.png" alt="image-20220531161329831"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if command -v pyenv 1&gt;/dev/null 2&gt;&amp;1; then</span><br><span class="line">  eval &quot;$(pyenv init -)&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h3 id="Fridaå®‰è£…"><a href="#Fridaå®‰è£…" class="headerlink" title="Fridaå®‰è£…"></a>Fridaå®‰è£…</h3><p>è‡ªå·±æ‰‹åŠ¨å®‰è£…frida,å¦‚æœç›´æ¥æŒ‰ä¸‹è¿°å®‰è£…åˆ™ä¼šç›´æ¥å®‰è£…fridaå’Œfrida-toolsçš„æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install frida-tools</span><br><span class="line">frida --version</span><br><span class="line">frida-ps --version</span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šfridaçš„ç‰ˆæœ¬å»å®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pyenv install 3.7.7</span><br><span class="line">pyenv local 3.7.7</span><br><span class="line">pip install frida==12.8.0</span><br><span class="line">pip install frida-tools==5.3.0</span><br></pre></td></tr></table></figure>
<p>è€ç‰ˆæœ¬fridaå’Œå¯¹åº”å…³ç³»<br>å¯¹åº”å…³ç³»å¾ˆå¥½æ‰¾</p>
<p><img src="/2022/09/06/Android Frida/image-20220531161924152.png" alt="image-20220531161924152"></p>
<h3 id="objection"><a href="#objection" class="headerlink" title="objection"></a>objection</h3><p>objectionæ˜¯åŸºäºfridaçš„ï¼Œæ‰€ä»¥objectionçš„ç‰ˆæœ¬è¦è·Ÿfridaå¯¹åº”ä¸Šï¼Œæ‰¾ç‰ˆæœ¬é—´çš„å¯¹åº”å…³ç³»æ˜¯å»objectionçš„releaseå¤„ï¼Œæ ¹æ®å‘å¸ƒæ—¶é—´æ‰¾æœ€æ¥è¿‘çš„</p>
<p><a href="https://github.com/sensepost/objection" target="_blank" rel="noopener">sensepost/objection: ğŸ“± objection - runtime mobile exploration (github.com)</a></p>
<h3 id="frida-server"><a href="#frida-server" class="headerlink" title="frida-server"></a>frida-server</h3><p>ä¸‹è½½frida-serverå¹¶è§£å‹ï¼Œåœ¨è¿™é‡Œä¸‹è½½<a href="https://github.com/frida/frida/releases/download/12.8.0/frida-server-12.8.0-android-arm64.xz" target="_blank" rel="noopener">frida-server-12.8.0</a></p>
<p>å…ˆadb shellï¼Œç„¶ååˆ‡æ¢åˆ°rootæƒé™,æŠŠä¹‹å‰pushè¿›æ¥çš„frida serveræ”¹ä¸ªåå­—å«fs<br>ç„¶åè¿è¡Œfrida</p>
<p>Androidæ‰‹æœºä¸€èˆ¬pushçš„é€šç”¨ç›®å½•å°±æ˜¯/data/local/tmp</p>
<p>å¦‚æœè¦ç›‘å¬ç«¯å£ï¼ˆå› ä¸ºappå¯èƒ½åfridaä¼šæ£€æµ‹é»˜è®¤ç«¯å£ï¼‰ï¼Œå°±</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fs -l 0.0.0.0:8888</span><br></pre></td></tr></table></figure>
<h3 id="fridaå¼€å‘ç¯å¢ƒ"><a href="#fridaå¼€å‘ç¯å¢ƒ" class="headerlink" title="fridaå¼€å‘ç¯å¢ƒ"></a>fridaå¼€å‘ç¯å¢ƒ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/oleavr/frida-agent-example.git</span><br><span class="line">cd frida-agent-example/</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>
<p>ä¸‹è½½ä¸Šé¢æ•´ä¸ªé¡¹ç›®ï¼Œä½¿ç”¨vscodeæ‰“å¼€æ­¤å·¥ç¨‹ï¼Œåœ¨agentæ–‡ä»¶å¤¹ä¸‹ç¼–å†™jsï¼Œä¼šæœ‰æ™ºèƒ½æç¤ºã€‚</p>
<p><code>npm run watch</code>ä¼šç›‘æ§ä»£ç ä¿®æ”¹è‡ªåŠ¨ç¼–è¯‘ç”Ÿæˆjsæ–‡ä»¶</p>
<p>pythonè„šæœ¬å½¢å¼çš„fridaè„šæœ¬æ³¨å…¥</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line">device8 = frida.get_device_manager().add_remote_device(<span class="string">"192.168.0.9:8888"</span>)</span><br><span class="line">pid = device8.spawn(<span class="string">"com.android.settings"</span>)</span><br><span class="line">device8.resume(pid)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">session = device8.attach(pid)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"si.js"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    script = session.create_script(f.read())</span><br><span class="line">script.load()</span><br><span class="line">input() <span class="comment">#ç­‰å¾…è¾“å…¥</span></span><br></pre></td></tr></table></figure>
<h2 id="Objectionæ“ä½œ"><a href="#Objectionæ“ä½œ" class="headerlink" title="Objectionæ“ä½œ"></a>Objectionæ“ä½œ</h2><p>Objectionä¹Ÿå¾ˆå¸¸ç”¨</p>
<p>Objectionæœ‰ä¸ªç¼ºé™·å°±æ˜¯ watch class çš„æ—¶å€™å›watchå¾ˆå¤š ä½†æ˜¯å”¯ç‹¬æ¼æ‰äº†æ„é€ å‡½æ•°</p>
<p>æ‰‹åŠ¨watchæ„é€ å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class_method java.io.File.$init  --dump-args  --dump-return</span><br></pre></td></tr></table></figure>
<h2 id="Frida-Java-Hook"><a href="#Frida-Java-Hook" class="headerlink" title="Frida Java Hook"></a>Frida Java Hook</h2><h3 id="æ‰“å°å‚æ•°ã€è¿”å›å€¼-è®¾ç½®è¿”å›å€¼-ä¸»åŠ¨è°ƒç”¨"><a href="#æ‰“å°å‚æ•°ã€è¿”å›å€¼-è®¾ç½®è¿”å›å€¼-ä¸»åŠ¨è°ƒç”¨" class="headerlink" title="æ‰“å°å‚æ•°ã€è¿”å›å€¼/è®¾ç½®è¿”å›å€¼/ä¸»åŠ¨è°ƒç”¨"></a>æ‰“å°å‚æ•°ã€è¿”å›å€¼/è®¾ç½®è¿”å›å€¼/ä¸»åŠ¨è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* access modifiers changed from: private */</span></span><br><span class="line">    <span class="keyword">public</span> Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle bundle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        <span class="keyword">this</span>.mContext = <span class="keyword">this</span>;</span><br><span class="line">        setContentView((<span class="keyword">int</span>) R.layout.activity_login);</span><br><span class="line">        <span class="keyword">final</span> EditText editText = (EditText) findViewById(R.id.username);</span><br><span class="line">        <span class="keyword">final</span> EditText editText2 = (EditText) findViewById(R.id.password);</span><br><span class="line">        ((Button) findViewById(R.id.login)).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">                String obj = editText.getText().toString();</span><br><span class="line">                String obj2 = editText2.getText().toString();</span><br><span class="line">                <span class="keyword">if</span> (TextUtils.isEmpty(obj) || TextUtils.isEmpty(obj2)) &#123;</span><br><span class="line">                    Toast.makeText(LoginActivity.<span class="keyword">this</span>.mContext, <span class="string">"username or password is empty."</span>, <span class="number">1</span>).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (LoginActivity.a(obj, obj).equals(obj2)) &#123;</span><br><span class="line">                    LoginActivity.<span class="keyword">this</span>.startActivity(<span class="keyword">new</span> Intent(LoginActivity.<span class="keyword">this</span>.mContext, FridaActivity1<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">                    LoginActivity.<span class="keyword">this</span>.finishActivity(<span class="number">0</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(LoginActivity.<span class="keyword">this</span>.mContext, <span class="string">"Login failed."</span>, <span class="number">1</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>LoginActivity.a(obj, obj).equals(obj2)</code>åˆ†æä¹‹åå¯å¾—obj2æ¥è‡ªpasswordï¼Œç”±ä»usernameå¾—æ¥çš„objï¼Œç»è¿‡aå‡½æ•°è¿ç®—ä¹‹åå¾—åˆ°ä¸€ä¸ªå€¼ï¼Œè¿™ä¸¤ä¸ªå€¼ç›¸ç­‰åˆ™ç™»å½•æˆåŠŸã€‚<br>æ‰€ä»¥è¿™é‡Œå…³é”®æ˜¯hook aå‡½æ•°çš„å‚æ•°ï¼Œè„šæœ¬å¦‚ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//æ‰“å°å‚æ•°ã€è¿”å›å€¼</span><br><span class="line">function Login()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.LoginActivity&quot;).a.overload(&apos;java.lang.String&apos;, &apos;java.lang.String&apos;).implementation = function (str, str2)&#123;</span><br><span class="line">            var result = this.a(str, str2);</span><br><span class="line">            console.log(&quot;args0:&quot;+str+&quot; args1:&quot;+str2+&quot; result:&quot;+result);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(Login)</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿè¾“å…¥å’Œè¾“å‡º,è¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥ä¸»åŠ¨è°ƒç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function login() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;start&quot;)</span><br><span class="line">        var login = Java.use(&quot;com.example.androiddemo.Activity.LoginActivity&quot;)</span><br><span class="line">        var result = login.a(&quot;1234&quot;,&quot;1234&quot;)</span><br><span class="line">        console.log(result)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(login)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">start</span><br><span class="line">4e4feaea959d426155a480dc07ef92f4754ee93edbe56d993d74f131497e66fb</span><br><span class="line">ç„¶å</span><br><span class="line">adb shell input text &quot;4e4feaea959d426155a480dc07ef92f4754ee93edbe56d993d74f131497e66fb&quot;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸»åŠ¨è°ƒç”¨é™æ€-éé™æ€å‡½æ•°-ä»¥åŠ-è®¾ç½®é™æ€-éé™æ€æˆå‘˜å˜é‡çš„å€¼"><a href="#ä¸»åŠ¨è°ƒç”¨é™æ€-éé™æ€å‡½æ•°-ä»¥åŠ-è®¾ç½®é™æ€-éé™æ€æˆå‘˜å˜é‡çš„å€¼" class="headerlink" title="ä¸»åŠ¨è°ƒç”¨é™æ€/éé™æ€å‡½æ•° ä»¥åŠ è®¾ç½®é™æ€/éé™æ€æˆå‘˜å˜é‡çš„å€¼"></a>ä¸»åŠ¨è°ƒç”¨é™æ€/éé™æ€å‡½æ•° ä»¥åŠ è®¾ç½®é™æ€/éé™æ€æˆå‘˜å˜é‡çš„å€¼</h3><p>ä¸»è¦å°±æ˜¯ä¸‹é¢ä¸‰ç‚¹</p>
<ul>
<li>é™æ€å‡½æ•°ç›´æ¥use classç„¶åè°ƒç”¨æ–¹æ³•ï¼Œéé™æ€å‡½æ•°éœ€è¦å…ˆchooseå®ä¾‹ç„¶åè°ƒç”¨</li>
<li>è®¾ç½®æˆå‘˜å˜é‡çš„å€¼ï¼Œå†™æ³•æ˜¯<code>xx.value = yy</code>ï¼Œå…¶ä»–æ–¹é¢å’Œå‡½æ•°ä¸€æ ·ã€‚</li>
<li>å¦‚æœæœ‰ä¸€ä¸ªæˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°çš„åå­—ç›¸åŒï¼Œåˆ™åœ¨å…¶å‰é¢åŠ ä¸€ä¸ª<code>_</code>ï¼Œå¦‚<code>_xx.value = yy</code></li>
</ul>
<h3 id="Hookå†…éƒ¨ç±»ï¼Œæšä¸¾ç±»çš„å‡½æ•°å¹¶Hook"><a href="#Hookå†…éƒ¨ç±»ï¼Œæšä¸¾ç±»çš„å‡½æ•°å¹¶Hook" class="headerlink" title="Hookå†…éƒ¨ç±»ï¼Œæšä¸¾ç±»çš„å‡½æ•°å¹¶Hook"></a>Hookå†…éƒ¨ç±»ï¼Œæšä¸¾ç±»çš„å‡½æ•°å¹¶Hook</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FridaActivity4</span> <span class="keyword">extends</span> <span class="title">BaseFridaActivity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNextCheckTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"å½“å‰ç¬¬4å…³"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClasses</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">check1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">check2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">check3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">check4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">check5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">check6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">InnerClasses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!InnerClasses.check1() || !InnerClasses.check2() || !InnerClasses.check3() || !InnerClasses.check4() || !InnerClasses.check5() || !InnerClasses.check6()) &#123;</span><br><span class="line">            <span class="keyword">super</span>.CheckFailed();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        CheckSuccess();</span><br><span class="line">        startActivity(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, FridaActivity5<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">        finishActivity(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€å…³çš„å…³é”®æ˜¯è®©<code>if (!InnerClasses.check1() || !InnerClasses.check2() || !InnerClasses.check3() || !InnerClasses.check4() || !InnerClasses.check5() || !InnerClasses.check6())</code>ä¸­çš„æ‰€æœ‰checkå…¨éƒ¨è¿”å›trueã€‚</p>
<p>å…¶å®è¿™é‡Œå”¯ä¸€çš„é—®é¢˜å°±æ˜¯å¯»æ‰¾å†…éƒ¨ç±»<code>InnerClasses</code>ï¼Œå¯¹äºå†…éƒ¨ç±»çš„hookï¼Œé€šè¿‡<code>ç±»å$å†…éƒ¨ç±»å</code>å»useã€‚</p>
<p>æ‰‹åŠ¨Hookæ‰€æœ‰çš„å‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">ch4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        <span class="keyword">var</span> InnerClasses = Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity4$InnerClasses"</span>)</span><br><span class="line">        console.log(<span class="string">"start"</span>)</span><br><span class="line">        InnerClasses.check1.implementation = function () &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        InnerClasses.check2.implementation = function () &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        InnerClasses.check3.implementation = function () &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        InnerClasses.check4.implementation = function () &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        InnerClasses.check5.implementation = function () &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        InnerClasses.check6.implementation = function () &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰¹é‡HOOKç”¨getDeclareMethods</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inner_classes = Java.use(<span class="string">"com.example.androiddemo.Activity.FridaActivity4$InnerClasses"</span>)</span><br><span class="line"><span class="keyword">var</span> all_methods = inner_classes.class.getDeclaredMethods();</span><br></pre></td></tr></table></figure>
<h3 id="Hookæ„é€ å‡½æ•°"><a href="#Hookæ„é€ å‡½æ•°" class="headerlink" title="Hookæ„é€ å‡½æ•°"></a>Hookæ„é€ å‡½æ•°</h3><p>ç”¨<code>$init</code>æ¥hookæ„é€ å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Java.use(<span class="string">"com.tlamb96.kgbmessenger.b.a"</span>).$init.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">i, str1, str2, z</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.$init(i, str1, str2, z)</span><br><span class="line">            <span class="built_in">console</span>.log(i, str1, str2, z)</span><br><span class="line">            printStack(<span class="string">"com.tlamb96.kgbmessenger.b.a"</span>)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰“å°æ ˆå›æº¯"><a href="#æ‰“å°æ ˆå›æº¯" class="headerlink" title="æ‰“å°æ ˆå›æº¯"></a>æ‰“å°æ ˆå›æº¯</h3><p>ç”¨çš„å°±æ˜¯Javaçš„Exceptionç±»çš„getStackTraceæ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printStack</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> Exception = Java.use(<span class="string">"java.lang.Exception"</span>);</span><br><span class="line">        <span class="keyword">var</span> ins = Exception.$<span class="keyword">new</span>(<span class="string">"Exception"</span>);</span><br><span class="line">        <span class="keyword">var</span> straces = ins.getStackTrace();</span><br><span class="line">        <span class="keyword">if</span> (straces != <span class="literal">undefined</span> &amp;&amp; straces != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> strace = straces.toString();</span><br><span class="line">            <span class="keyword">var</span> replaceStr = strace.replace(<span class="regexp">/,/g</span>, <span class="string">"\\n"</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"============================="</span> + name + <span class="string">" Stack strat======================="</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(replaceStr);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"============================="</span> + name + <span class="string">" Stack end=======================\r\n"</span>);</span><br><span class="line">            Exception.$dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Spwan-Attach"><a href="#Spwan-Attach" class="headerlink" title="Spwan/Attach"></a>Spwan/Attach</h3><p>fridaæ³¨å…¥æ—¶-få‚æ•°ä»£è¡¨spawnå¯åŠ¨ï¼Œspawné€‚ç”¨äºä¸€äº›APPåœ¨åˆšå¯åŠ¨æ—¶å°±è¿›è¡Œçš„ä¸€äº›æ“ä½œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/* access modifiers changed from: protected */</span></span><br><span class="line">    public <span class="keyword">void</span> onCreate(Bundle bundle) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView((int) R.layout.activity_main);</span><br><span class="line">        <span class="built_in">String</span> property = System.getProperty(<span class="string">"user.home"</span>);</span><br><span class="line">        <span class="built_in">String</span> str = System.getenv(<span class="string">"USER"</span>);</span><br><span class="line">        <span class="keyword">if</span> (property == <span class="literal">null</span> || property.isEmpty() || !property.equals(<span class="string">"Russia"</span>)) &#123;</span><br><span class="line">            a(<span class="string">"Integrity Error"</span>, <span class="string">"This app can only run on Russian devices."</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str == <span class="literal">null</span> || str.isEmpty() || !str.equals(getResources().getString(R.string.User))) &#123;</span><br><span class="line">            a(<span class="string">"Integrity Error"</span>, <span class="string">"Must be on the user whitelist."</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a.a(<span class="keyword">this</span>);</span><br><span class="line">            startActivity(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, LoginActivity.class));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºè¿™ä¸ªcheckæ˜¯åœ¨<code>onCreate</code>é‡Œï¼Œæ‰€ä»¥appåˆšå¯åŠ¨å°±è‡ªåŠ¨æ£€æŸ¥ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨spawnçš„æ–¹å¼å»å¯åŠ¨fridaè„šæœ¬hookï¼Œè€Œä¸æ˜¯attachã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ£€æŸ¥ï¼Œä¸€ä¸ªæ˜¯æ£€æŸ¥propertyçš„å€¼ï¼Œä¸€ä¸ªæ˜¯æ£€æŸ¥strçš„å€¼ã€‚<br>åˆ†åˆ«ä»<code>System.getProperty</code>å’Œ<code>System.getenv</code>é‡Œè·å–ï¼Œhookä½è¿™ä¸¤ä¸ªå‡½æ•°å°±è¡Œã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        Java.use(<span class="string">"java.lang.System"</span>).getProperty.overload(<span class="string">'java.lang.String'</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Russia"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Java.use(<span class="string">"java.lang.System"</span>).getenv.overload(<span class="string">'java.lang.String'</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"RkxBR3s1N0VSTDFOR180UkNIM1J9Cg=="</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure>
<h3 id="è·å–ç±»å"><a href="#è·å–ç±»å" class="headerlink" title="è·å–ç±»å"></a>è·å–ç±»å</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRealClassName</span>(<span class="params">å¯¹è±¡</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> objClass = Java.use(<span class="string">"java.lang.Object"</span>).getClass.apply(å¯¹è±¡);</span><br><span class="line">    <span class="keyword">return</span> Java.use(<span class="string">"java.lang.Class"</span>).getName.apply(objClass)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€»è¾‘å°±æ˜¯å…ˆç”¨getClassè·å–ç±»ï¼Œå†ç”¨getNameè·å–ç±»åï¼Œåªä¸è¿‡è¿™é‡Œå†™æ³•æ˜¯applyæ¥åå‘ç»‘å®šå¯¹è±¡</p>
<h3 id="æ³¨å…¥dex"><a href="#æ³¨å…¥dex" class="headerlink" title="æ³¨å…¥dex"></a>æ³¨å…¥dex</h3><p>å®ä¾‹å¯ä»¥å‚è€ƒgson</p>
<p>æ€»ç»“ï¼š<br>ç¼–è¯‘å‡ºdexä¹‹åï¼Œé€šè¿‡<code>Java.openClassFile(&quot;xxx.dex&quot;).load()</code>åŠ è½½ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ­£å¸¸é€šè¿‡<code>Java.use</code>è°ƒç”¨é‡Œé¢çš„æ–¹æ³•äº†ã€‚</p>
<p>åˆ¶ä½œdexçš„è¯ï¼Œä¸€ä¸ªæ˜¯å¯ä»¥ç›´æ¥æŠŠclassæ–‡ä»¶è½¬æˆdexï¼Œæ¯”è¾ƒæ‡’å°±æ˜¯ç›´æ¥å†™æˆapkï¼Œç„¶åè§£å‹æå–classes.dex</p>
<h3 id="æšä¸¾activity"><a href="#æšä¸¾activity" class="headerlink" title="æšä¸¾activity"></a>æšä¸¾activity</h3><p><img src="/2022/09/06/Android Frida/image-20220531175401090.png" alt="image-20220531175401090"></p>
<p>ä»objectionä¸­å¾—åˆ°çš„çµæ„Ÿ</p>
<h3 id="Hookæ‰€æœ‰çš„event-æŒ‰é’®äº‹ä»¶"><a href="#Hookæ‰€æœ‰çš„event-æŒ‰é’®äº‹ä»¶" class="headerlink" title="Hookæ‰€æœ‰çš„event(æŒ‰é’®äº‹ä»¶)"></a>Hookæ‰€æœ‰çš„event(æŒ‰é’®äº‹ä»¶)</h3><p><a href="https://github.com/hluwa/objection-plugins/blob/master/watch_events/agent.js" target="_blank" rel="noopener">objection-plugins/agent.js at master Â· hluwa/objection-plugins (github.com)</a></p>
<p>è‘«èŠ¦å¨ƒå¤§ä½¬çš„è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬éå¸¸æ˜¾åŠŸåº•ï¼Œhook eventé¦–å…ˆå°±å¾—æ‰¾åˆ°è¦ç›‘æ§çš„Onclickå‡½æ•°æ‰€å¤„çš„ç±» ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯ä¼ ä¸€ä¸ªnewçš„å¯¹è±¡ç»™æ³¨å†Œçš„æŒ‰é’®äº‹ä»¶</p>
<p><img src="/2022/09/06/Android Frida/image-20220718223514178.png" alt="image-20220718223514178"></p>
<p>è¿™é‡Œè„šæœ¬ä¸­é¦–å…ˆæˆªè·setOnclickListenerå¾—åˆ°æ³¨å†Œçš„å¯¹è±¡ï¼Œç„¶åå†ç”¨getobjClassNameè·å–å¯¹è±¡çš„ç±»åï¼Œå†ç›‘æ§å™¨OnClickäº‹ä»¶ï¼Œæˆ‘ä»¬å¹³æ—¶è¦ç”¨çš„è¯ï¼Œè¿™é‡Œå¯ä»¥åŠ ä¸Šæ‰“å°è°ƒç”¨æ ˆç›¸å…³çš„ä¿¡æ¯</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Author: hluwa &lt;hluwa888@gmail.com&gt;</span></span><br><span class="line"><span class="comment">* HomePage: https://github.com/hluwa</span></span><br><span class="line"><span class="comment">* CreatedTime: 2020/3/8 22:42</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">var</span> jclazz = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> jobj = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getObjClassName</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!jclazz) &#123;</span><br><span class="line">        <span class="keyword">var</span> jclazz = Java.use(<span class="string">"java.lang.Class"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!jobj) &#123;</span><br><span class="line">        <span class="keyword">var</span> jobj = Java.use(<span class="string">"java.lang.Object"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jclazz.getName.call(jobj.getClass.call(obj));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">watch</span>(<span class="params">obj, mtdName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> listener_name = getObjClassName(obj);</span><br><span class="line">    <span class="keyword">var</span> target = Java.use(listener_name);</span><br><span class="line">    <span class="keyword">if</span> (!target || !mtdName <span class="keyword">in</span> target) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// send("[WatchEvent] hooking " + mtdName + ": " + listener_name);</span></span><br><span class="line">    target[mtdName].overloads.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">overload</span>) </span>&#123;</span><br><span class="line">        overload.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            send(<span class="string">"[WatchEvent] "</span> + mtdName + <span class="string">": "</span> + getObjClassName(<span class="keyword">this</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>[mtdName].apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rpc.exports = &#123;</span><br><span class="line">    onclick: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Java.use(<span class="string">"android.view.View"</span>).setOnClickListener.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">listener</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (listener != <span class="literal">null</span>) &#123;</span><br><span class="line">                    watch(listener, <span class="string">'onClick'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.setOnClickListener(listener);</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Java.choose(<span class="string">"android.view.View$ListenerInfo"</span>, &#123;</span><br><span class="line">                onMatch: <span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">                    instance = instance.mOnClickListener.value;</span><br><span class="line">                    <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">                        watch(instance, <span class="string">'onClick'</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰“å°å’Œå‚æ•°æ„é€ "><a href="#æ‰“å°å’Œå‚æ•°æ„é€ " class="headerlink" title="æ‰“å°å’Œå‚æ•°æ„é€ "></a>æ‰“å°å’Œå‚æ•°æ„é€ </h3><p>fridaæœ¬æ¥å°±æ˜¯ç½®äºJavaè™šæ‹Ÿæœºçš„ï¼Œæ‰€ä»¥å„ç§å¤æ‚çš„æ‰“å°åªè¦å–é£ŸäºJavaæœ¬èº«å°±è¡Œ</p>
<ul>
<li>æ•°ç»„/(å­—ç¬¦ä¸²)å¯¹è±¡æ•°ç»„/gson/Java.array</li>
<li>å¯¹è±¡/å¤šæ€ã€å¼ºè½¬Java.cast/æ¥å£Java.register</li>
<li>æ³›å‹ã€Listã€Mapã€Setã€è¿­ä»£æ‰“å°</li>
<li>non-ascii ã€ child-gatingã€rpc ä¸Šä¼ åˆ°PCä¸Šæ‰“å°</li>
</ul>
<h4 id="frida-å¯¹objectã€-object-object-çš„æ‰“å°"><a href="#frida-å¯¹objectã€-object-object-çš„æ‰“å°" class="headerlink" title="frida å¯¹objectã€[object,object]çš„æ‰“å°"></a>frida å¯¹objectã€[object,object]çš„æ‰“å°</h4><ul>
<li><p>ç¢°è¿æ°”</p>
<ul>
<li>å¯¹è±¡.toString()</li>
<li>JSON.stringify(å¯¹è±¡)</li>
<li>gson.$new().toJson(å¯¹è±¡)   <a href="https://bbs.pediy.com/thread-259186.htm" target="_blank" rel="noopener"><code>Frida</code>æ‰“å°[object]è§£å†³<code>gson</code>åŒ…é‡åçš„é—®é¢˜-Androidå®‰å…¨-çœ‹é›ªè®ºå›-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|bbs.pediy.com</a></li>
</ul>
</li>
<li><p>é å®åŠ›</p>
<ul>
<li><p>å…ˆè·å–ç±»å</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRealClassName</span>(<span class="params">å¯¹è±¡</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> objClass = Java.use(<span class="string">"java.lang.Object"</span>).getClass.apply(å¯¹è±¡);</span><br><span class="line">    <span class="keyword">return</span> Java.use(<span class="string">"java.lang.Class"</span>).getName.apply(objClass)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç”¨wallBreakeræŸ¥çœ‹è¯¥ç±»çš„è¾“å‡ºå‡½æ•° <a href="https://github.com/hluwa/Wallbreaker" target="_blank" rel="noopener">hluwa/Wallbreaker: ğŸ”¨ Break Java Reverse Engineering form Memory World! (github.com)</a></p>
</li>
<li><p>ä¸»åŠ¨è°ƒç”¨è¯¥ç±»çš„è¾“å‡ºå‡½æ•°è¿›è¡Œè¾“å‡º</p>
</li>
</ul>
</li>
</ul>
<h4 id="gson"><a href="#gson" class="headerlink" title="gson"></a>gson</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Java.openClassFile(<span class="string">"/data/local/tmp/r0gson.dex"</span>).load();</span><br><span class="line"><span class="keyword">const</span> gson = Java.use(<span class="string">'com.r0ysue.gson.Gson'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(gson.$<span class="keyword">new</span>().toJson(xxx));</span><br></pre></td></tr></table></figure>
<p>gsonçš„ç”¨æ³•ä¹Ÿæ˜¯ç”¨fridaæ³¨å…¥è‡ªå·±çš„dexçš„æ¡ˆä¾‹</p>
<h4 id="java-Arrayæ„é€ "><a href="#java-Arrayæ„é€ " class="headerlink" title="java Arrayæ„é€ "></a>java Arrayæ„é€ </h4><h4 id="æ‰“å°hashmap"><a href="#æ‰“å°hashmap" class="headerlink" title="æ‰“å°hashmap"></a>æ‰“å°hashmap</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.choose(<span class="string">"java.util.HashMap"</span>,&#123;</span><br><span class="line">            onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">instance</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(instance.toString().indexOf(<span class="string">"ISBN"</span>)!= <span class="number">-1</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"instance.toString:"</span>,instance.toString());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="attr">onComplete</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"search complete!"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>å»å†…å­˜é‡Œéå†HashMapï¼ŒtoStringä¹‹åå†è¿‡æ»¤å…³é”®å­—</p>
<p>æ›´ç»†çš„æ“ä½œ</p>
<p><img src="/2022/09/06/Android Frida/image-20220531171626939.png" alt="image-20220531171626939"></p>
<h2 id="Frida-Native-Hook"><a href="#Frida-Native-Hook" class="headerlink" title="Frida Native Hook"></a>Frida Native Hook</h2><h4 id="Javaå±‚çš„Nativeå‡½æ•°çš„hookå’Œä¸»åŠ¨è°ƒç”¨"><a href="#Javaå±‚çš„Nativeå‡½æ•°çš„hookå’Œä¸»åŠ¨è°ƒç”¨" class="headerlink" title="Javaå±‚çš„Nativeå‡½æ•°çš„hookå’Œä¸»åŠ¨è°ƒç”¨"></a>Javaå±‚çš„Nativeå‡½æ•°çš„hookå’Œä¸»åŠ¨è°ƒç”¨</h4><p>è·Ÿæ™®é€šJavaå‡½æ•°æ²¡ä»€ä¹ˆåŒºåˆ«,å› ä¸ºNativeçš„å‡½æ•°è¦åœ¨Javaå±‚ä½¿ç”¨ï¼Œæ˜¯ä¼šé¦–å…ˆå£°æ˜åœ¨javaå±‚ä¸­ï¼Œåªä¸è¿‡åŠ äº†ä¸ªnative</p>
<h4 id="Hookå¯¼å‡ºå‡½æ•°"><a href="#Hookå¯¼å‡ºå‡½æ•°" class="headerlink" title="Hookå¯¼å‡ºå‡½æ•°"></a>Hookå¯¼å‡ºå‡½æ•°</h4><p>é™¤äº†Hookç›´æ¥åœ¨Javaå±‚æ³¨å†Œçš„Nativeå‡½æ•°ï¼ŒSOä¸­å¯¼å‡ºçš„å‡½æ•°ä¹Ÿå¯ä»¥Hook</p>
<ul>
<li><p>é¦–å…ˆæ˜¯æ‰¾åˆ°æ˜¯å¦soè¢«åŠ è½½ï¼Œé€šè¿‡<code>Process.enumerateModules()</code>,è¿™ä¸ªAPIå¯ä»¥æšä¸¾è¢«åŠ è½½åˆ°å†…å­˜çš„modulesã€‚</p>
</li>
<li><p>ç„¶åé€šè¿‡<code>Module.findBaseAddress(module name)</code>æ¥æŸ¥æ‰¾è¦hookçš„å‡½æ•°æ‰€åœ¨çš„soçš„åŸºåœ°å€ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›nullã€‚</p>
</li>
<li><p>ç„¶åå¯ä»¥é€šè¿‡<code>findExportByName(moduleName: string, exportName: string): NativePointer</code>æ¥æŸ¥æ‰¾å¯¼å‡ºå‡½æ•°çš„ç»å¯¹åœ°å€ã€‚å¦‚æœä¸çŸ¥é“moduleNameæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªnullè¿›å…¥ï¼Œä½†æ˜¯ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´éå†æ‰€æœ‰çš„moduleã€‚å¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›nullã€‚</p>
</li>
<li><p>æ‰¾åˆ°åœ°å€ä¹‹åï¼Œå°±å¯ä»¥æ‹¦æˆªfunction/instructionçš„æ‰§è¡Œã€‚é€šè¿‡<code>Interceptor.attach</code>ã€‚ä½¿ç”¨æ–¹æ³•è§ä¸‹ä»£ç ã€‚</p>
</li>
<li>å¦å¤–ä¸ºäº†å°†jstringçš„å€¼æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥ä½¿ç”¨jenvçš„å‡½æ•°getStringUtfCharsï¼Œå°±åƒæ­£å¸¸çš„å†™nativeç¨‹åºä¸€æ ·ã€‚<br><code>Java.vm.getEnv().getStringUtfChars(args[2], null).readCString()</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span></span><br><span class="line">JNIEXPORT jstring JNICALL</span><br><span class="line">Java_myapplication_example_com_ndk_1demo_MainActivity_stringWithJNI(JNIEnv *env, jobject instance,</span><br><span class="line">                                                                    jstring context_) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *context = env-&gt;GetStringUTFChars(context_, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> context_size = env-&gt;GetStringUTFLength(context_);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (context_size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        LOGD(<span class="string">"%s\n"</span>, context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    env-&gt;ReleaseStringUTFChars(context_, context);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(<span class="string">"sakura1328"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>hookè„šæœ¬</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_native</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(JSON.stringify(Process.enumerateModules()));</span></span><br><span class="line">    <span class="keyword">var</span> libnative_addr = Module.findBaseAddress(<span class="string">"libnative-lib.so"</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"libnative_addr is: "</span> + libnative_addr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (libnative_addr) &#123;</span><br><span class="line">        <span class="keyword">var</span> string_with_jni_addr = Module.findExportByName(<span class="string">"libnative-lib.so"</span>, </span><br><span class="line">        <span class="string">"Java_myapplication_example_com_ndk_1demo_MainActivity_stringWithJNI"</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"string_with_jni_addr is: "</span> + string_with_jni_addr)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(string_with_jni_addr, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"string_with_jni args: "</span> + args[<span class="number">0</span>], args[<span class="number">1</span>], args[<span class="number">2</span>])</span><br><span class="line">            <span class="built_in">console</span>.log(Java.vm.getEnv().getStringUtfChars(args[<span class="number">2</span>], <span class="literal">null</span>).readCString())</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"retval:"</span>, retval)</span><br><span class="line">            <span class="built_in">console</span>.log(Java.vm.getEnv().getStringUtfChars(retval, <span class="literal">null</span>).readCString())</span><br><span class="line">            <span class="keyword">var</span> newRetval = Java.vm.getEnv().newStringUtf(<span class="string">"new retval from hook_native"</span>);</span><br><span class="line">            retval.replace(ptr(newRetval));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getStringUtfCharsæ˜¯å¾—åˆ°jstringçš„cæŒ‡é’ˆï¼ŒcæŒ‡é’ˆé‡Œæ˜¯å­—ç¬¦ä¸²çš„å†…å®¹ï¼ŒreadCStringæ˜¯ä»ä¸€ä¸ªNativePointerä¸­è¯»å–å­—ç¬¦ä¸²å†…å®¹</p>
<blockquote>
<ul>
<li><p><code>readCString([size = -1])</code>, <code>readUtf8String([size = -1])</code>, <code>readUtf16String([length = -1])</code>, <code>readAnsiString([size = -1])</code>: reads the bytes at this memory location as an ASCII, UTF-8, UTF-16, or ANSI string. Supply the optional <code>size</code> argument if you know the size of the string in bytes, or omit it or specify <em>-1</em> if the string is NUL-terminated. Likewise you may supply the optional <code>length</code> argument if you know the length of the string in characters.</p>
<p>A JavaScript exception will be thrown if any of the <code>size</code> / <code>length</code> bytes read from the address isnâ€™t readable.</p>
<p>Note that <code>readAnsiString()</code> is only available (and relevant) on Windows.</p>
</li>
</ul>
</blockquote>
<h4 id="Hook-Libc"><a href="#Hook-Libc" class="headerlink" title="Hook Libc"></a>Hook Libc</h4><p>æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œæ‰¾åˆ°libc.soçš„æ¨¡å—ï¼Œå†æšä¸¾ç¬¦å·å°±è¡Œäº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_libc</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pthread_create_addr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> symbols = Process.findModuleByName(<span class="string">"libc.so"</span>).enumerateSymbols();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;symbols.length;i++)&#123;</span><br><span class="line">        <span class="keyword">var</span> symbol = symbols[i].name;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(symbol.indexOf(<span class="string">"pthread_create"</span>)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//console.log(symbols[i].name);</span></span><br><span class="line">            <span class="comment">//console.log(symbols[i].address);</span></span><br><span class="line">            pthread_create_addr = symbols[i].address;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"pthread_create_addr,"</span>,pthread_create_addr);</span><br><span class="line">    Interceptor.attach(pthread_create_addr,&#123;</span><br><span class="line">        onEnter:<span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"pthread_create_addr args[0],args[1],args[2],args[3]:"</span>,args[<span class="number">0</span>],args[<span class="number">1</span>],args[<span class="number">2</span>],args[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">        &#125;,<span class="attr">onLeave</span>:<span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"retval is:"</span>,retval)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id><a href="#" class="headerlink" title=" "></a> </h4><h4 id="Native-è°ƒç”¨æ ˆæ‰“å°"><a href="#Native-è°ƒç”¨æ ˆæ‰“å°" class="headerlink" title="Native è°ƒç”¨æ ˆæ‰“å°"></a>Native è°ƒç”¨æ ˆæ‰“å°</h4><p>fridaæä¾›äº†æ¥å£</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(f, &#123;</span><br><span class="line">  onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'RegisterNatives called from:\n'</span> +</span><br><span class="line">        Thread.backtrace(<span class="keyword">this</span>.context, Backtracer.ACCURATE)</span><br><span class="line">        .map(DebugSymbol.fromAddress).join(<span class="string">'\n'</span>) + <span class="string">'\n'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ‰“å°çš„æ•ˆæœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Google Pixel::myapplication.example.com.ndk_demo]-&gt; RegisterNatives called from:</span><br><span class="line">0x7a100be03c libart.so!0xe103c</span><br><span class="line">0x7a100be038 libart.so!0xe1038</span><br><span class="line">0x79f85699a0 libnative-lib.so!_ZN7_JNIEnv15RegisterNativesEP7_jclassPK15JNINativeMethodi+0x44</span><br><span class="line">0x79f85698e0 libnative-lib.so!JNI_OnLoad+0x90</span><br><span class="line">0x7a102b9fd4 libart.so!_ZN3art9JavaVMExt17LoadNativeLibraryEP7_JNIEnvRKNSt3__112basic_stringIcNS3_11char_traitsIcEENS3_9allocatorIcEEEEP8_jobjectP8_jstringPS9_+0x638</span><br><span class="line">0x7a08e3820c libopenjdkjvm.so!JVM_NativeLoad+0x110</span><br><span class="line">0x70b921c4 boot.oat!oatexec+0xa81c4</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å®˜æ–¹æ–‡æ¡£å°±è¿™æ ·å†™çš„</p>
<blockquote>
<ul>
<li><p><code>Thread.backtrace([context, backtracer])</code>: generate a backtrace for the current thread, returned as an array of <a href="https://frida.re/docs/javascript-api/#nativepointer" target="_blank" rel="noopener"><code>NativePointer</code></a> objects.</p>
<p>If you call this from Interceptorâ€™s <a href="https://frida.re/docs/javascript-api/#interceptor-onenter" target="_blank" rel="noopener"><code>onEnter</code></a> or <a href="https://frida.re/docs/javascript-api/#interceptor-onleave" target="_blank" rel="noopener"><code>onLeave</code></a> callbacks you should provide <code>this.context</code> for the optional <code>context</code> argument, as it will give you a more accurate backtrace. Omitting <code>context</code> means the backtrace will be generated from the current stack location, which may not give you a very good backtrace due to the JavaScript VMâ€™s stack frames. The optional <code>backtracer</code> argument specifies the kind of backtracer to use, and must be either <code>Backtracer.FUZZY</code> or <code>Backtracer.ACCURATE</code>, where the latter is the default if not specified. The accurate kind of backtracers rely on debugger-friendly binaries or presence of debug information to do a good job, whereas the fuzzy backtracers perform forensics on the stack in order to guess the return addresses, which means you will get false positives, but it will work on any binary.</p>
</li>
</ul>
</blockquote>
<h4 id="Native-æ–¹æ³•æ›¿æ¢"><a href="#Native-æ–¹æ³•æ›¿æ¢" class="headerlink" title="Native æ–¹æ³•æ›¿æ¢"></a>Native æ–¹æ³•æ›¿æ¢</h4><p>ç›´æ¥æ›¿æ¢æ‰æ•´ä¸ªNativeæ–¹æ³•çš„è¯ï¼Œç”¨çš„æ˜¯Interceptorçš„replaceï¼Œè€Œä¸æ˜¯attach</p>
<p>ä¹Ÿæ˜¯åœ¨æ–‡æ¡£é‡Œæœ‰å¯¹æ ‡çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> openPtr = Module.getExportByName(<span class="string">'libc.so'</span>, <span class="string">'open'</span>);</span><br><span class="line"><span class="keyword">const</span> open = <span class="keyword">new</span> NativeFunction(openPtr, <span class="string">'int'</span>, [<span class="string">'pointer'</span>, <span class="string">'int'</span>]);</span><br><span class="line">Interceptor.replace(openPtr, <span class="keyword">new</span> NativeCallback(<span class="function">(<span class="params">pathPtr, flags</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> path = pathPtr.readUtf8String();</span><br><span class="line">  log(<span class="string">'Opening "'</span> + path + <span class="string">'"'</span>);</span><br><span class="line">  <span class="keyword">const</span> fd = open(pathPtr, flags);</span><br><span class="line">  log(<span class="string">'Got fd: '</span> + fd);</span><br><span class="line">  <span class="keyword">return</span> fd;</span><br><span class="line">&#125;, <span class="string">'int'</span>, [<span class="string">'pointer'</span>, <span class="string">'int'</span>]));</span><br></pre></td></tr></table></figure>
<h4 id="inline-Hook"><a href="#inline-Hook" class="headerlink" title="inline Hook"></a>inline Hook</h4><p>inline hookå°±æ˜¯ä»»æ„åœ°å€hookï¼Œå‰é¢ä»‹ç»çš„interceptorçš„å¸¸è§„æ–¹æ³•éƒ½æ˜¯å‡½æ•°å¤´hook</p>
<p>ä¸€ä¸‹é¢ARM64ä»£ç ä¸ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000000772C ; __unwind &#123;</span><br><span class="line">.text:000000000000772C                 SUB             SP, SP, #0x40</span><br><span class="line">.text:0000000000007730                 STP             X29, X30, [SP,#0x30+var_s0]</span><br><span class="line">.text:0000000000007734                 ADD             X29, SP, #0x30</span><br><span class="line">.text:0000000000007738 ; 6:   v6 = a1;</span><br><span class="line">.text:0000000000007738                 MOV             X8, XZR</span><br><span class="line">.text:000000000000773C                 STUR            X0, [X29,#var_8]</span><br><span class="line">.text:0000000000007740 ; 7:   v5 = a3;</span><br><span class="line">.text:0000000000007740                 STUR            X1, [X29,#var_10]</span><br><span class="line">.text:0000000000007744                 STR             X2, [SP,#0x30+var_18]</span><br><span class="line">.text:0000000000007748 ; 8:   v4 = (const char *)_JNIEnv::GetStringUTFChars(a1, a3, 0LL);</span><br><span class="line">.text:0000000000007748                 LDUR            X0, [X29,#var_8]</span><br><span class="line">.text:000000000000774C                 LDR             X1, [SP,#0x30+var_18]</span><br><span class="line">.text:0000000000007750                 MOV             X2, X8</span><br><span class="line">.text:0000000000007754                 BL              ._ZN7_JNIEnv17GetStringUTFCharsEP8_jstringPh ; _JNIEnv::GetStringUTFChars(_jstring *,uchar *)</span><br><span class="line">.text:0000000000007758                 STR             X0, [SP,#0x30+var_20]</span><br><span class="line">.text:000000000000775C ; 9:   if ( (signed int)_JNIEnv::GetStringUTFLength(v6, v5) &gt; 0 )</span><br><span class="line">.text:000000000000775C                 LDUR            X0, [X29,#var_8]</span><br><span class="line">.text:0000000000007760                 LDR             X1, [SP,#0x30+var_18]</span><br></pre></td></tr></table></figure>
<p>åœ¨775Cæ—¶ï¼Œx0é‡Œä¿å­˜çš„æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚hookè¿™ä¸ªæŒ‡ä»¤ï¼Œç„¶å<code>Memory.readCString(this.context.x0);</code>æ‰“å°å‡ºæ¥ï¼Œhookè„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inline_hook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> libnative_lib_addr = Module.findBaseAddress(<span class="string">"libnative-lib.so"</span>);</span><br><span class="line">    <span class="keyword">if</span> (libnative_lib_addr) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"libnative_lib_addr:"</span>, libnative_lib_addr);</span><br><span class="line">        <span class="keyword">var</span> addr_775C = libnative_lib_addr.add(<span class="number">0x775C</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"addr_775C:"</span>, addr_775C);</span><br><span class="line"></span><br><span class="line">        Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            Interceptor.attach(addr_775C, &#123;</span><br><span class="line">                onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> name = <span class="keyword">this</span>.context.x0.readCString()</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"addr_775C OnEnter :"</span>, <span class="keyword">this</span>.returnAddress, name);</span><br><span class="line">                &#125;,</span><br><span class="line">                onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>) </span>&#123;</span><br><span class="line">                     <span class="built_in">console</span>.log(<span class="string">"retval is :"</span>, retval) </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(inline_hook())</span><br></pre></td></tr></table></figure>
<p>å…¶å®çœ‹è¿™é‡Œå°±çŸ¥é“ï¼ŒInterceptor.attachæ˜¯å¯ä»¥ç”¨ä»»æ„åœ°å€çš„ï¼Œtargetåªè¦æ˜¯ä¸ªNativePointerå°±è¡Œ</p>
<p>è¿™é‡Œè¿›å»ä¹‹åå¯ä»¥ç”¨contextè·å–ä¸Šä¸‹æ–‡å¯„å­˜å™¨ï¼Œthiså¯¹è±¡åŠcontextå¦‚ä¸‹</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Callback to invoke when an instruction is about to be executed.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> InstructionProbeCallback = <span class="function">(<span class="params"><span class="keyword">this</span>: InvocationContext, args: InvocationArguments</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"><span class="keyword">type</span> InvocationContext = PortableInvocationContext | WindowsInvocationContext | UnixInvocationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> PortableInvocationContext &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return address.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    returnAddress: NativePointer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * CPU registers. You may also update register values by assigning to these keys.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    context: CpuContext;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * OS thread ID.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    threadId: ThreadId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Call depth of relative to other invocations.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    depth: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * User-defined invocation data. Useful if you want to read an argument in `onEnter` and act on it in `onLeave`.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    [x: <span class="built_in">string</span>]: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="keyword">interface</span> Arm64CpuContext <span class="keyword">extends</span> PortableCpuContext &#123;</span><br><span class="line">    x0: NativePointer;</span><br><span class="line">    x1: NativePointer;</span><br><span class="line">    x2: NativePointer;</span><br><span class="line">    x3: NativePointer;</span><br><span class="line">    x4: NativePointer;</span><br><span class="line">    x5: NativePointer;</span><br><span class="line">    x6: NativePointer;</span><br><span class="line">    x7: NativePointer;</span><br><span class="line">    x8: NativePointer;</span><br><span class="line">    x9: NativePointer;</span><br><span class="line">    x10: NativePointer;</span><br><span class="line">    x11: NativePointer;</span><br><span class="line">    x12: NativePointer;</span><br><span class="line">    x13: NativePointer;</span><br><span class="line">    x14: NativePointer;</span><br><span class="line">    x15: NativePointer;</span><br><span class="line">    x16: NativePointer;</span><br><span class="line">    x17: NativePointer;</span><br><span class="line">    x18: NativePointer;</span><br><span class="line">    x19: NativePointer;</span><br><span class="line">    x20: NativePointer;</span><br><span class="line">    x21: NativePointer;</span><br><span class="line">    x22: NativePointer;</span><br><span class="line">    x23: NativePointer;</span><br><span class="line">    x24: NativePointer;</span><br><span class="line">    x25: NativePointer;</span><br><span class="line">    x26: NativePointer;</span><br><span class="line">    x27: NativePointer;</span><br><span class="line">    x28: NativePointer;</span><br><span class="line"></span><br><span class="line">    fp: NativePointer;</span><br><span class="line">    lr: NativePointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Nativeä¸»åŠ¨è°ƒç”¨æœªå¯¼å‡ºå‡½æ•°"><a href="#Nativeä¸»åŠ¨è°ƒç”¨æœªå¯¼å‡ºå‡½æ•°" class="headerlink" title="Nativeä¸»åŠ¨è°ƒç”¨æœªå¯¼å‡ºå‡½æ•°"></a>Nativeä¸»åŠ¨è°ƒç”¨æœªå¯¼å‡ºå‡½æ•°</h4><p>ä¾‹å­å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span></span><br><span class="line">JNIEXPORT jint JNICALL</span><br><span class="line">Java_com_example_ndk_1demo_MainActivity_sakuraWithInt(JNIEnv *env, jobject thiz, jint a, jint b) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement sakuraWithInt()</span></span><br><span class="line">    <span class="keyword">return</span> sakura_add(a,b);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sakura_add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = a+b;</span><br><span class="line">    LOGD(<span class="string">"sakura add a+b:"</span>,sum);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®NativePointeråˆ›å»ºä¸€ä¸ªNativeFunctionå°±å¯ä»¥ç›´æ¥è°ƒç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> libnative_lib_addr = Module.findBaseAddress(<span class="string">"libnative-lib.so"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"libnative_lib_addr is :"</span>, libnative_lib_addr);</span><br><span class="line">    <span class="keyword">if</span> (libnative_lib_addr) &#123;</span><br><span class="line">        <span class="keyword">var</span> sakura_add_addr1 = Module.findExportByName(<span class="string">"libnative-lib.so"</span>, <span class="string">"_Z10sakura_addii"</span>);</span><br><span class="line">        <span class="keyword">var</span> sakura_add_addr2 = libnative_lib_addr.add(<span class="number">0x0F56C</span>) ;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"sakura_add_addr1 "</span>, sakura_add_addr1);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"sakura_add_addr2 "</span>, sakura_add_addr2)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sakura_add1 = <span class="keyword">new</span> NativeFunction(sakura_add_addr1, <span class="string">"int"</span>, [<span class="string">"int"</span>, <span class="string">"int"</span>]);</span><br><span class="line">    <span class="keyword">var</span> sakura_add2 = <span class="keyword">new</span> NativeFunction(sakura_add_addr2, <span class="string">"int"</span>, [<span class="string">"int"</span>, <span class="string">"int"</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"sakura_add1 result is :"</span>, sakura_add1(<span class="number">200</span>, <span class="number">33</span>));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"sakura_add2 result is :"</span>, sakura_add2(<span class="number">100</span>, <span class="number">133</span>));</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main())</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">libnative_lib_addr is : <span class="number">0x79fa1c5000</span></span><br><span class="line">sakura_add_addr1  <span class="number">0x79fa1d456c</span></span><br><span class="line">sakura_add_addr2  <span class="number">0x79fa1d456c</span></span><br><span class="line">sakura_add1 result is : <span class="number">233</span></span><br><span class="line">sakura_add2 result is : <span class="number">233</span></span><br></pre></td></tr></table></figure>
<h4 id="ä¸»åŠ¨åŠ è½½soå¹¶è°ƒç”¨å‡½æ•°-SOæ³¨å…¥"><a href="#ä¸»åŠ¨åŠ è½½soå¹¶è°ƒç”¨å‡½æ•°-SOæ³¨å…¥" class="headerlink" title="ä¸»åŠ¨åŠ è½½soå¹¶è°ƒç”¨å‡½æ•°(SOæ³¨å…¥)"></a>ä¸»åŠ¨åŠ è½½soå¹¶è°ƒç”¨å‡½æ•°(SOæ³¨å…¥)</h4><h2 id="Fridaåè°ƒè¯•"><a href="#Fridaåè°ƒè¯•" class="headerlink" title="Fridaåè°ƒè¯•"></a>Fridaåè°ƒè¯•</h2><p>è¿™ä¸€èŠ‚çš„ä¸»è¦å†…å®¹å°±æ˜¯å…³äºåè°ƒè¯•çš„åŸç†å’Œå¦‚ä½•ç ´è§£åè°ƒè¯•ï¼Œé‡è¦å†…å®¹è¿˜æ˜¯çœ‹æ–‡ç« ç†è§£å³å¯ã€‚<br>å› ä¸ºæˆ‘å¹¶ä¸éœ€è¦åšåè°ƒè¯•ç›¸å…³çš„å·¥ä½œï¼Œæ‰€ä»¥éƒ¨åˆ†å†…å®¹ç•¥è¿‡ã€‚</p>
<ul>
<li><p>Fridaåè°ƒè¯•ä¸ååè°ƒè¯•åŸºæœ¬æ€è·¯</p>
<p>ï¼ˆJavaå±‚APIã€Nativeå±‚APIã€Syscall)</p>
<ul>
<li><a href="https://github.com/qtfreet00/AntiFrida" target="_blank" rel="noopener">AntiFrida</a></li>
<li><a href="https://github.com/b-mueller/frida-detection-demo" target="_blank" rel="noopener">frida-detection-demo</a></li>
<li><a href="https://bbs.pediy.com/thread-217482.htm" target="_blank" rel="noopener">å¤šç§ç‰¹å¾æ£€æµ‹Frida</a></li>
<li><a href="https://yq.aliyun.com/articles/71120" target="_blank" rel="noopener">æ¥è‡ªé«˜ç»´çš„å¯¹æŠ— - é€†å‘TinyToolè‡ªåˆ¶</a></li>
<li><a href="https://bbs.pediy.com/thread-253868.htm" target="_blank" rel="noopener">Unicorn åœ¨ Android çš„åº”ç”¨</a></li>
</ul>
</li>
</ul>
<p>#### </p>
<h2 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h2><p><a href="https://eternalsakura13.com/2020/07/04/frida/" target="_blank" rel="noopener">Frida Android hook | Sakuraã®blog (eternalsakura13.com)</a></p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/09/06/Android Kernel Build/" rel="next" title="Android Kernel Build">
                <i class="fa fa-chevron-left"></i> Android Kernel Build
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/09/18/Androidæ¶ˆæ¯å¤„ç†æœºåˆ¶/" rel="prev" title="Androidæ¶ˆæ¯å¤„ç†æœºåˆ¶">
                Androidæ¶ˆæ¯å¤„ç†æœºåˆ¶ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/head.jpg" alt="zzrR0">
            
              <p class="site-author-name" itemprop="name">zzrR0</p>
              <p class="site-description motion-element" itemprop="description">Why am i so cai.</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://xmzyshypnc.github.io/" title="xmzyshypnc" target="_blank">xmzyshypnc</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://wood1314.github.io/" title="Wood" target="_blank">Wood</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.zeddyu.info/" title="Zedd" target="_blank">Zedd</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://kestudy.top/" title="Ke" target="_blank">Ke</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-Frida"><span class="nav-number">1.</span> <span class="nav-text">Android Frida</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#fridaç¯å¢ƒ"><span class="nav-number">1.1.</span> <span class="nav-text">fridaç¯å¢ƒ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pyenv"><span class="nav-number">1.1.1.</span> <span class="nav-text">pyenv</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fridaå®‰è£…"><span class="nav-number">1.1.2.</span> <span class="nav-text">Fridaå®‰è£…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#objection"><span class="nav-number">1.1.3.</span> <span class="nav-text">objection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#frida-server"><span class="nav-number">1.1.4.</span> <span class="nav-text">frida-server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fridaå¼€å‘ç¯å¢ƒ"><span class="nav-number">1.1.5.</span> <span class="nav-text">fridaå¼€å‘ç¯å¢ƒ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Objectionæ“ä½œ"><span class="nav-number">1.2.</span> <span class="nav-text">Objectionæ“ä½œ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Frida-Java-Hook"><span class="nav-number">1.3.</span> <span class="nav-text">Frida Java Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ‰“å°å‚æ•°ã€è¿”å›å€¼-è®¾ç½®è¿”å›å€¼-ä¸»åŠ¨è°ƒç”¨"><span class="nav-number">1.3.1.</span> <span class="nav-text">æ‰“å°å‚æ•°ã€è¿”å›å€¼/è®¾ç½®è¿”å›å€¼/ä¸»åŠ¨è°ƒç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸»åŠ¨è°ƒç”¨é™æ€-éé™æ€å‡½æ•°-ä»¥åŠ-è®¾ç½®é™æ€-éé™æ€æˆå‘˜å˜é‡çš„å€¼"><span class="nav-number">1.3.2.</span> <span class="nav-text">ä¸»åŠ¨è°ƒç”¨é™æ€/éé™æ€å‡½æ•° ä»¥åŠ è®¾ç½®é™æ€/éé™æ€æˆå‘˜å˜é‡çš„å€¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hookå†…éƒ¨ç±»ï¼Œæšä¸¾ç±»çš„å‡½æ•°å¹¶Hook"><span class="nav-number">1.3.3.</span> <span class="nav-text">Hookå†…éƒ¨ç±»ï¼Œæšä¸¾ç±»çš„å‡½æ•°å¹¶Hook</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hookæ„é€ å‡½æ•°"><span class="nav-number">1.3.4.</span> <span class="nav-text">Hookæ„é€ å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ‰“å°æ ˆå›æº¯"><span class="nav-number">1.3.5.</span> <span class="nav-text">æ‰“å°æ ˆå›æº¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spwan-Attach"><span class="nav-number">1.3.6.</span> <span class="nav-text">Spwan/Attach</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·å–ç±»å"><span class="nav-number">1.3.7.</span> <span class="nav-text">è·å–ç±»å</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ³¨å…¥dex"><span class="nav-number">1.3.8.</span> <span class="nav-text">æ³¨å…¥dex</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æšä¸¾activity"><span class="nav-number">1.3.9.</span> <span class="nav-text">æšä¸¾activity</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hookæ‰€æœ‰çš„event-æŒ‰é’®äº‹ä»¶"><span class="nav-number">1.3.10.</span> <span class="nav-text">Hookæ‰€æœ‰çš„event(æŒ‰é’®äº‹ä»¶)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ‰“å°å’Œå‚æ•°æ„é€ "><span class="nav-number">1.3.11.</span> <span class="nav-text">æ‰“å°å’Œå‚æ•°æ„é€ </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#frida-å¯¹objectã€-object-object-çš„æ‰“å°"><span class="nav-number">1.3.11.1.</span> <span class="nav-text">frida å¯¹objectã€[object,object]çš„æ‰“å°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#gson"><span class="nav-number">1.3.11.2.</span> <span class="nav-text">gson</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-Arrayæ„é€ "><span class="nav-number">1.3.11.3.</span> <span class="nav-text">java Arrayæ„é€ </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ‰“å°hashmap"><span class="nav-number">1.3.11.4.</span> <span class="nav-text">æ‰“å°hashmap</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Frida-Native-Hook"><span class="nav-number">1.4.</span> <span class="nav-text">Frida Native Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Javaå±‚çš„Nativeå‡½æ•°çš„hookå’Œä¸»åŠ¨è°ƒç”¨"><span class="nav-number">1.4.0.1.</span> <span class="nav-text">Javaå±‚çš„Nativeå‡½æ•°çš„hookå’Œä¸»åŠ¨è°ƒç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hookå¯¼å‡ºå‡½æ•°"><span class="nav-number">1.4.0.2.</span> <span class="nav-text">Hookå¯¼å‡ºå‡½æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hook-Libc"><span class="nav-number">1.4.0.3.</span> <span class="nav-text">Hook Libc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.4.0.4.</span> <span class="nav-text"> </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Native-è°ƒç”¨æ ˆæ‰“å°"><span class="nav-number">1.4.0.5.</span> <span class="nav-text">Native è°ƒç”¨æ ˆæ‰“å°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Native-æ–¹æ³•æ›¿æ¢"><span class="nav-number">1.4.0.6.</span> <span class="nav-text">Native æ–¹æ³•æ›¿æ¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#inline-Hook"><span class="nav-number">1.4.0.7.</span> <span class="nav-text">inline Hook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Nativeä¸»åŠ¨è°ƒç”¨æœªå¯¼å‡ºå‡½æ•°"><span class="nav-number">1.4.0.8.</span> <span class="nav-text">Nativeä¸»åŠ¨è°ƒç”¨æœªå¯¼å‡ºå‡½æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸»åŠ¨åŠ è½½soå¹¶è°ƒç”¨å‡½æ•°-SOæ³¨å…¥"><span class="nav-number">1.4.0.9.</span> <span class="nav-text">ä¸»åŠ¨åŠ è½½soå¹¶è°ƒç”¨å‡½æ•°(SOæ³¨å…¥)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fridaåè°ƒè¯•"><span class="nav-number">1.5.</span> <span class="nav-text">Fridaåè°ƒè¯•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Refs"><span class="nav-number">1.6.</span> <span class="nav-text">Refs</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zzrR0</span>

  

  
</div>




  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ â€“ <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Pisces</a> v6.3.0</div>






        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="æ€»è®¿å®¢é‡">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="æ€»è®¿é—®é‡">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  

  
    <script id="dsq-count-scr" src="https://xmzyshypnc.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2022/09/06/Android Frida/';
        this.page.identifier = '2022/09/06/Android Frida/';
        this.page.title = 'Android Frida';
        };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://xmzyshypnc.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: true,
        appId: 'YbpHIa6XHNsKv4wX2wGjnrK7-gzGzoHsz',
        appKey: '1fjf9mQl90nKdRPfq1zhDyIE',
        placeholder: '',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: true
    });
  </script>



  





  

  

  

  

  
  

  

  

  

  

  

  
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"live2d-widget-model-hijiki"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-50},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"tagMode":false});</script></body>
</html>
